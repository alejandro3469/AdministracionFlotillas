@* Modal de Información de Detalles del Producto - Campos editables por defecto *@
<ejs-tooltip id="tooltipModalDetallesProducto" 
             target=".info-tooltip-detalles-producto" 
             opensOn="Hover" 
             width="300px"
             position="TopCenter"
             beforeRender="tooltipModalDetallesProductoBeforeRender">
    <e-content-template>
        <div id="tooltipContentDetallesProducto"></div>
    </e-content-template>
</ejs-tooltip>

<ejs-dialog id="modalDetallesProducto" 
            isModal="true" 
            showCloseIcon="true" 
            width="700px" 
            height="auto"
            visible="false"
            header="Información de Detalles - Producto #<span id='modalDetallesProductoTitulo'>0</span>"
            created="modalDetallesProductoCreated"
            open="modalDetallesProductoOpen"
            close="modalDetallesProductoClose">
    <e-content-template>
        <div id="modalDetallesProductoContenido" class="p-3">
            <div class="alert alert-warning mb-3">
                <h6 class="alert-heading"><i class="fas fa-info-circle me-2"></i>¿Qué es la Información de Detalles?</h6>
                <p class="mb-0 small">
                    La información de detalles contiene datos descriptivos y técnicos del producto: 
                    descripción completa, especificaciones técnicas, calidad del producto y cualquier información adicional. 
                    Esta información se usa para catálogos, páginas web y documentación del producto.
                </p>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0"><i class="fas fa-file-alt me-2"></i>Descripción y Especificaciones</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            Descripción del Producto
                            <i class="fas fa-question-circle text-muted ms-1 info-tooltip-detalles-producto" 
                               data-field="Descripcion" 
                               data-tooltip="Descripción completa y detallada del producto. Incluya características principales, beneficios y uso. Esta descripción aparecerá en catálogos y páginas web."></i>
                        </label>
                        <textarea id="modalDetallesDescripcion" class="form-control" rows="4" placeholder="Ingrese una descripción detallada del producto"></textarea>
                        <small class="text-muted">Descripción completa para catálogos</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            Calidad del Producto
                            <i class="fas fa-question-circle text-muted ms-1 info-tooltip-detalles-producto" 
                               data-field="Calidad" 
                               data-tooltip="Calificación de calidad del producto en una escala de 1 a 5. Se usa para evaluar la calidad general del producto y puede influir en decisiones de compra y precios."></i>
                        </label>
                        <div id="ratingCalidadDetalles"></div>
                        <small class="text-muted">Calificación de 1 a 5 estrellas</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            Especificaciones Técnicas
                            <i class="fas fa-question-circle text-muted ms-1 info-tooltip-detalles-producto" 
                               data-field="Especificaciones" 
                               data-tooltip="Especificaciones técnicas del producto (dimensiones, peso, materiales, etc.). Se usa para documentación técnica y cumplimiento de estándares."></i>
                        </label>
                        <textarea id="modalDetallesEspecificaciones" class="form-control" rows="3" placeholder="Dimensiones, peso, materiales, etc."></textarea>
                        <small class="text-muted">Especificaciones técnicas opcionales</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            Notas Adicionales
                            <i class="fas fa-question-circle text-muted ms-1 info-tooltip-detalles-producto" 
                               data-field="Notas" 
                               data-tooltip="Notas adicionales sobre el producto (instrucciones de uso, advertencias, información de garantía, etc.)."></i>
                        </label>
                        <textarea id="modalDetallesNotas" class="form-control" rows="2" placeholder="Notas adicionales (opcional)"></textarea>
                        <small class="text-muted">Información adicional opcional</small>
                    </div>
                </div>
            </div>
        </div>
    </e-content-template>
    <e-dialog-buttons>
        <e-dialog-dialogbutton id="btnModalDetallesProductoGuardar" content="Guardar Cambios" isPrimary="true" cssClass="e-flat" click="modalDetallesProductoGuardar"></e-dialog-dialogbutton>
        <e-dialog-dialogbutton id="btnModalDetallesProductoCancelar" content="Cancelar" isPrimary="false" cssClass="e-flat" click="modalDetallesProductoCancelar"></e-dialog-dialogbutton>
    </e-dialog-buttons>
</ejs-dialog>

<script>
    if (typeof window.modalDetallesProductoId === 'undefined') {
        window.modalDetallesProductoId = null;
    }
    if (typeof modalDetallesProductoId === 'undefined') {
        var modalDetallesProductoId = null;
    }
    var tooltipModalDetallesProductoObj = null;
    window.modalDetallesProductoInstance = null;
    
    window.mostrarModalDetallesProducto = function() {
        if (window.modalDetallesProductoInstance) {
            try {
                window.modalDetallesProductoInstance.show();
                return true;
            } catch (e) {
                console.warn('Error al mostrar modal:', e);
            }
        }
        
        var elemento = document.getElementById('modalDetallesProducto');
        if (elemento && elemento.ej2_instances && elemento.ej2_instances[0]) {
            try {
                elemento.ej2_instances[0].show();
                window.modalDetallesProductoInstance = elemento.ej2_instances[0];
                return true;
            } catch (e) {
                console.warn('Error al mostrar modal:', e);
            }
        }
        return false;
    };
    
    window.ocultarModalDetallesProducto = function() {
        if (window.modalDetallesProductoInstance) {
            try {
                window.modalDetallesProductoInstance.hide();
                return true;
            } catch (e) {
                console.warn('Error al ocultar modal:', e);
            }
        }
        return false;
    };
    
    window.modalDetallesProductoCreated = function(args) {
        if (args && args.component) {
            window.modalDetallesProductoInstance = args.component;
        } else {
            var elemento = document.getElementById('modalDetallesProducto');
            if (elemento && elemento.ej2_instances && elemento.ej2_instances[0]) {
                window.modalDetallesProductoInstance = elemento.ej2_instances[0];
            }
        }
    };
    
    window.modalDetallesProductoOpen = function() {
        setTimeout(function() {
            var tooltipElement = document.getElementById('tooltipModalDetallesProducto');
            if (tooltipElement && tooltipElement.ej2_instances && tooltipElement.ej2_instances[0]) {
                tooltipModalDetallesProductoObj = tooltipElement.ej2_instances[0];
            }
            
            // Inicializar Rating si no está inicializado
            if (typeof ej !== 'undefined' && ej.inputs && !document.getElementById('ratingCalidadDetalles').ej2_instances) {
                var rating = new ej.inputs.Rating({
                    value: 0,
                    precision: 'Half',
                    showLabel: true,
                    labelTemplate: '<span>Calidad: ${value}/5</span>'
                });
                rating.appendTo('#ratingCalidadDetalles');
            }
        }, 100);
    };
    
    window.modalDetallesProductoClose = function() {
        // Limpiar datos si es necesario
    };
    
    window.modalDetallesProductoGuardar = function() {
        if (window.Products && window.Products.Modal) {
            window.Products.Modal.GuardarDetalles();
        }
    };
    
    window.modalDetallesProductoCancelar = function() {
        window.ocultarModalDetallesProducto();
    };
    
    window.tooltipModalDetallesProductoBeforeRender = function(args) {
        var tooltipText = args.target.getAttribute('data-tooltip') || '';
        var contentDiv = document.getElementById('tooltipContentDetallesProducto');
        if (contentDiv) {
            contentDiv.innerHTML = '<div style="padding: 8px;">' + tooltipText + '</div>';
        }
    };
</script>
