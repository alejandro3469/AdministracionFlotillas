@using AdministracionFlotillas.Web.ViewModels
@{
    ViewData["Title"] = "Gestión de Empleados";
}

<div class="container-fluid">
    <!-- Breadcrumb Navigation Mejorado -->
    @if (ViewBag.Breadcrumb != null)
    {
        @await Html.PartialAsync("_BreadcrumbConIndicadores", ViewBag.Breadcrumb as BreadcrumbViewModel)
    }
    
    <div class="row mb-3">
        <div class="col-12">
            <h2 class="mb-0">Gestión de Empleados</h2>
            <p class="text-muted">Administración de empleados de la empresa</p>
        </div>
    </div>

    <!-- Indicadores Compactos -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="card">
                <div class="card-body py-2">
                    <div class="d-flex flex-wrap align-items-center gap-3">
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas fa-user-tie text-primary"></i>
                            <span class="text-muted small">Total Empleados:</span>
                            <strong class="text-primary" id="totalEmpleados">0</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Grid de Empleados -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-2 py-2">
                    <h5 class="card-title mb-0">Lista de Empleados</h5>
                    <button type="button" class="btn btn-primary btn-sm" onclick="if(window.Employees && window.Employees.Table) window.Employees.Table.Reload();">
                        <i class="fas fa-sync-alt"></i> <span class="d-none d-sm-inline">Actualizar</span>
                    </button>
                </div>
                <div class="card-body position-relative p-0">
                    <!-- Spinner de carga -->
                    <div id="loadingSpinner" class="text-center py-5" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Cargando...</span>
                        </div>
                        <p class="mt-2 text-muted">Cargando datos...</p>
                    </div>
    @await Html.PartialAsync("_EmployeesGrid")
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Enviar por Email -->
<div class="modal fade" id="modalEnviarEmail" tabindex="-1" aria-labelledby="modalEnviarEmailLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalEnviarEmailLabel">
                    <i class="fas fa-envelope"></i> Enviar Información por Email
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="emailReceptor" class="form-label">Email del Receptor</label>
                    <input type="email" class="form-control" id="emailReceptor" placeholder="ejemplo@empresa.com" required>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead class="table-dark">
                            <tr>
                                <th>Nombre Completo</th>
                                <th>Email</th>
                                <th>Teléfono</th>
                                <th>Fecha Contratación</th>
                                <th>Salario</th>
                                <th>Departamento</th>
                            </tr>
                        </thead>
                        <tbody id="tablaResumenEmpleados">
                            <!-- Se llena dinámicamente con los empleados seleccionados -->
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" id="btnConfirmarEnvio">
                    <i class="fas fa-paper-plane"></i> Enviar Email
                </button>
            </div>
        </div>
    </div>
</div>

    @section Scripts {
        <!-- Employees module uses DataTables, not Syncfusion Grid yet -->
        <!-- TODO: Migrate to Syncfusion Grid when ready -->
        <!-- <script src="~/js/Employees/Employees.js" asp-append-version="true"></script> -->
    
    <script>
        // All functionality is now in Employees namespace
        // Access methods like: Employees.Table.Reload(), Employees.Filters.Apply(), etc.
        // The namespace auto-initializes when the page loads
        // 
        // Example usage:
        // - Employees.Table.Reload() - Reload table data
        // - Employees.Filters.Apply() - Apply all filters
        // - Employees.Selection.GetSelected() - Get selected employees
        // - Employees.Email.OpenModal() - Open email modal
        // - Employees.Details.View(id) - View employee details
        // - Employees.Selection.Clear() - Clear all selections
    </script>
}
