function handleCustomerActionButtonsClick(n){var i=n.target.closest(".btn-ver-cliente, .btn-editar-cliente"),t;i&&(t=i.getAttribute("data-id-cliente"),t&&t!=="undefined"&&t!=="null"?(t=parseInt(t,10),t&&!isNaN(t)&&t>0?i.classList.contains("btn-ver-cliente")?window.Customers&&window.Customers.Modal?window.Customers.Modal.Abrir(t,"ver"):console.error("Customers.Modal no está disponible"):i.classList.contains("btn-editar-cliente")&&(window.Customers&&window.Customers.Modal?window.Customers.Modal.Abrir(t,"editar"):console.error("Customers.Modal no está disponible")):console.error("ID de cliente no válido:",t)):console.error("No se pudo obtener ID de cliente del botón. data-id-cliente:",t))}window.customersGridCreated=function(){console.log("Grid de clientes creado, cargando datos...");window.Customers&&window.Customers.Grid&&window.Customers.Grid.CargarDatos()};window.customersGridRowSelected=function(n){console.log("Cliente seleccionado:",n.data)};window.customersGridActionComplete=function(n){n.requestType==="filtering"&&window.Customers&&window.Customers.Dashboard&&window.Customers.Dashboard.ActualizarMetricas()};window.customersGridDataBound=function(){var n=document.getElementById("customersGrid");n&&(n.removeEventListener("click",handleCustomerActionButtonsClick),n.addEventListener("click",handleCustomerActionButtonsClick))};window.customersGridToolbarClick=function(n){var t=document.getElementById("customersGrid"),r,i,u;if(!t||!t.ej2_instances||!t.ej2_instances[0]){console.warn("Grid no encontrado para exportación");return}if(r=t.ej2_instances[0],u="Clientes_"+(new Date).toISOString().split("T")[0],n.item.text==="Excel Export"||n.item.id&&n.item.id.includes("excelexport"))i=r.excelExport({fileName:u+".xlsx"});else if(n.item.text==="Pdf Export"||n.item.id&&n.item.id.includes("pdfexport"))i=r.pdfExport({fileName:u+".pdf"});else return;i&&i.then(function(){window.Customers.Utilidades.MostrarExito("Exportación Exitosa","El archivo se ha descargado correctamente.")}).catch(function(n){window.Customers.Utilidades.MostrarError("Error de Exportación","No se pudo exportar. Por favor, intenta nuevamente.");console.error("Error al exportar:",n)})};window.filtroNombreChange=window.debounce(function(){window.Customers&&window.Customers.Filtros&&window.Customers.Filtros.Aplicar()},300);window.filtroEstadoChange=window.debounce(function(){window.Customers&&window.Customers.Filtros&&window.Customers.Filtros.Aplicar()},300);window.Customers=window.Customers||{};var modalClienteId=null,modalClienteModo="ver";(function(){"use strict";window.Customers.Utilidades={MostrarError:function(n,t){typeof Swal!="undefined"?Swal.fire({icon:"error",title:n||"Error",text:t||"Ha ocurrido un error.",confirmButtonText:"Aceptar"}):alert(n+": "+t)},MostrarExito:function(n,t){typeof Swal!="undefined"?Swal.fire({icon:"success",title:n||"Éxito",text:t||"Operación completada.",confirmButtonText:"Aceptar",timer:2e3,showConfirmButton:!1}):alert(n+": "+t)}};window.Customers.Grid={CargarDatos:function(){var i=document.getElementById("customersGrid"),t,n;if(!i){console.warn("Grid element no encontrado");return}if(t=i.ej2_instances&&i.ej2_instances[0],!t){setTimeout(function(){window.Customers.Grid.CargarDatos()},500);return}n=new XMLHttpRequest;n.open("POST","/Customers/ObtenerCustomers",!0);n.setRequestHeader("Content-Type","application/json");n.onreadystatechange=function(){if(n.readyState===4)if(n.status===200)try{var i=JSON.parse(n.responseText);i.exito&&i.datos?(t.dataSource=i.datos,t.refresh(),console.log("Clientes cargados:",i.datos.length)):window.Customers.Utilidades.MostrarError("Error al cargar datos",i.mensaje||"No se pudieron cargar los clientes.")}catch(r){window.Customers.Utilidades.MostrarError("Error","Error al procesar la respuesta del servidor.");console.error("Error al parsear respuesta:",r)}else window.Customers.Utilidades.MostrarError("Error de Conexión","Error al conectar con el servidor."),console.error("Error al cargar clientes:",n.status,n.statusText)};n.send()},Recargar:function(){this.CargarDatos()}};window.Customers.Filtros={Aplicar:function(){var i=document.getElementById("customersGrid"),t,r,n;i&&(t=i.ej2_instances&&i.ej2_instances[0],t)&&(r={Nombre:this.ObtenerNombre(),Estado:this.ObtenerEstado()},n=new XMLHttpRequest,n.open("POST","/Customers/BuscarCustomers",!0),n.setRequestHeader("Content-Type","application/json"),n.onreadystatechange=function(){if(n.readyState===4)if(n.status===200)try{var i=JSON.parse(n.responseText);i.exito?(t.dataSource=i.datos,t.refresh()):window.Customers.Utilidades.MostrarError("Error al aplicar filtros",i.mensaje||"No se pudieron aplicar los filtros.")}catch(r){window.Customers.Utilidades.MostrarError("Error","Error al procesar la respuesta del servidor.");console.error("Error al parsear respuesta:",r)}else window.Customers.Utilidades.MostrarError("Error de Conexión","Error al conectar con el servidor."),console.error("Error al aplicar filtros:",n.status,n.statusText)},n.send(JSON.stringify(r)))},Limpiar:function(){var t=document.getElementById("filtroNombre"),n;t&&t.ej2_instances&&t.ej2_instances[0]&&(t.ej2_instances[0].value="");n=document.getElementById("filtroEstado");n&&n.ej2_instances&&n.ej2_instances[0]&&(n.ej2_instances[0].value=null);window.Customers&&window.Customers.Grid&&window.Customers.Grid.CargarDatos()},ObtenerNombre:function(){var t=document.getElementById("filtroNombre"),n;return t?(n=t.value||"",n&&n.trim()?n.trim():null):null},ObtenerEstado:function(){var n=document.getElementById("filtroEstado");return!n||!n.ej2_instances?null:n.ej2_instances[0]?n.ej2_instances[0].value:null}};window.Customers.Dashboard={ActualizarMetricas:function(){var n=new XMLHttpRequest;n.open("POST","/Customers/ObtenerMetricas",!0);n.setRequestHeader("Content-Type","application/json");n.onreadystatechange=function(){var i,t,u,f;if(n.readyState===4)if(n.status===200)try{if(i=JSON.parse(n.responseText),i.exito&&i.datos){t=i.datos;u=t.totalClientes||0;function r(n,t){var i=document.getElementById(n);i&&(i.textContent=t)}r("totalClientes",u);r("clientesActivos",t.clientesActivos||0);r("clientesInactivos",t.clientesInactivos||0);r("clientesNuevos",t.clientesNuevos||0);f=document.querySelector('[id^="breadcrumb-contador-"]');f&&(f.textContent=u.toString())}}catch(e){console.error("Error al parsear métricas:",e)}else console.error("Error al actualizar métricas de clientes:",n.status,n.statusText)};n.send()}};window.Customers.Modal={Abrir:function(n,t){var i=parseInt(n,10);if(!i||isNaN(i)||i<=0){window.Customers.Utilidades.MostrarError("Error","ID de cliente no válido.");return}modalClienteId=i;modalClienteModo=t||"ver";this.CargarDatosCliente(i)},CargarDatosCliente:function(n){var i=this,t=new XMLHttpRequest;t.open("POST","/Customers/ObtenerCustomerPorId",!0);t.setRequestHeader("Content-Type","application/json");t.onreadystatechange=function(){if(t.readyState===4)if(t.status===200)try{var n=JSON.parse(t.responseText);n.exito&&n.datos?(i.MostrarDatos(n.datos),i.AbrirDialog()):window.Customers.Utilidades.MostrarError("Error",n.mensaje||"No se pudo cargar el cliente.")}catch(r){window.Customers.Utilidades.MostrarError("Error","Error al procesar la respuesta del servidor.");console.error("Error al parsear respuesta:",r)}else window.Customers.Utilidades.MostrarError("Error de Conexión","Error al cargar el cliente."),console.error("Error al cargar cliente:",t.status,t.statusText)};t.send(JSON.stringify(n))},MostrarDatos:function(n){function i(n){return document.getElementById(n)}function t(n,t){var r=i(n);r&&(r.textContent=t)}function u(n,t){var r=i(n);r&&(r.innerHTML=t)}t("modalClienteTitulo",n.IdCliente);t("modalIdCliente",n.IdCliente);t("modalNombreCliente",n.NombreCliente||"-");t("modalEmailCliente",n.Email||"-");t("modalTelefonoCliente",n.Telefono||"-");var r="";r=n.EstadoCliente==="ACTIVE"?'<span class="badge bg-success info-tooltip-cliente" data-field="EstadoCliente" data-tooltip="Cliente activo, puede realizar compras y operaciones">'+n.EstadoCliente+"<\/span>":'<span class="badge bg-secondary info-tooltip-cliente" data-field="EstadoCliente" data-tooltip="Cliente inactivo, bloqueado o suspendido">'+(n.EstadoCliente||"INACTIVE")+"<\/span>";u("modalEstadoCliente",r);t("modalDireccionCliente",n.Direccion||"-");t("modalCiudadCliente",n.Ciudad||"-");t("modalEstadoDireccionCliente",n.Estado||"-");t("modalCodigoPostalCliente",n.CodigoPostal||"-");t("modalPaisCliente",n.Pais||"-");t("modalLimiteCredito","$"+(n.LimiteCredito||0).toFixed(2));t("modalTotalOrdenes",n.TotalOrdenes||0);t("modalTotalCompras","$"+(n.TotalCompras||0).toFixed(2));n.FechaRegistro?t("modalFechaRegistro",new Date(n.FechaRegistro).toLocaleDateString("es-MX")):t("modalFechaRegistro","-")},AbrirDialog:function(){function u(){if(typeof modalClienteInstance!="undefined"&&window.modalClienteInstance!==null)return window.modalClienteInstance;var n=document.getElementById("modalCliente");return n&&n.ej2_instances&&n.ej2_instances[0]?n.ej2_instances[0]:null}function i(){n++;var f=u();if(f)try{f.show();console.log("✅ Modal abierto correctamente después de "+n+" intentos");window.modalClienteInstance=f;setTimeout(function(){var n=document.getElementById("tooltipModalCliente");n&&n.ej2_instances&&n.ej2_instances[0]&&typeof tooltipModalClienteObj!="undefined"&&(tooltipModalClienteObj=n.ej2_instances[0])},100);return}catch(e){console.error("❌ Error al abrir modal:",e);window.Customers.Utilidades.MostrarError("Error","No se pudo abrir el modal: "+e.message);return}n<t?(n%10==0&&console.log("⏳ Esperando inicialización del modal... Intento "+n+"/"+t),setTimeout(i,r)):(console.error("❌ Modal no inicializado después de "+t+" intentos"),window.Customers.Utilidades.MostrarError("Error","El modal no está disponible. Por favor, recarga la página."))}if(typeof mostrarModalCliente=="function"&&window.mostrarModalCliente()){console.log("✅ Modal abierto usando función helper");setTimeout(function(){var n=document.getElementById("tooltipModalCliente");n&&n.ej2_instances&&n.ej2_instances[0]&&typeof tooltipModalClienteObj!="undefined"&&(tooltipModalClienteObj=n.ej2_instances[0])},100);return}var f=this,n=0,t=50,r=100;setTimeout(i,50)},CambiarAModoEdicion:function(){window.Customers.Utilidades.MostrarExito("Modo Edición","El modo edición se implementará próximamente.")}};window.Customers.Detalles={Ver:function(n){window.Customers.Modal.Abrir(n,"ver")}};window.Customers.Edicion={Editar:function(n){window.Customers.Modal.Abrir(n,"editar")}}})();