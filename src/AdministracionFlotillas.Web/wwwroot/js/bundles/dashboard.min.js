window.Dashboard=window.Dashboard||{},function(){"use strict";window.Dashboard.Metricas={Cargar:function(){$.ajax({url:"/Home/ObtenerMetricas",method:"POST",success:function(n){if(n.exito&&n.datos){var t=n.datos;$("#totalVentas").text("$"+parseFloat(t.totalVentas||0).toFixed(2));$("#ordenesHoy").text(t.ordenesHoy||0);$("#clientesActivos").text(t.clientesActivos||0);$("#totalProductos").text(t.totalProductos||0)}},error:function(){console.error("Error al cargar métricas del dashboard")}})}};window.Dashboard.Filtros={Aplicar:function(){var n={idCliente:null,idTienda:null,estado:null,fechaInicio:null,fechaFin:null},f=document.getElementById("filtroClienteId"),t,i,r,u;f&&f.ej2_instances&&f.ej2_instances[0]&&f.ej2_instances[0].value&&(n.idCliente=f.ej2_instances[0].value);t=document.getElementById("filtroTiendaId");t&&t.ej2_instances&&t.ej2_instances[0]&&t.ej2_instances[0].value&&(n.idTienda=t.ej2_instances[0].value);i=document.getElementById("filtroEstado");i&&i.ej2_instances&&i.ej2_instances[0]&&i.ej2_instances[0].value&&(n.estado=i.ej2_instances[0].value);r=document.getElementById("filtroFechaInicio");r&&r.ej2_instances&&r.ej2_instances[0]&&r.ej2_instances[0].value&&(n.fechaInicio=r.ej2_instances[0].value);u=document.getElementById("filtroFechaFin");u&&u.ej2_instances&&u.ej2_instances[0]&&u.ej2_instances[0].value&&(n.fechaFin=u.ej2_instances[0].value);window.Dashboard.Grid.CargarDatos(n)},Limpiar:function(){var u=document.getElementById("filtroClienteId"),n,t,i,r;u&&u.ej2_instances&&u.ej2_instances[0]&&(u.ej2_instances[0].value=null,u.ej2_instances[0].dataBind());n=document.getElementById("filtroTiendaId");n&&n.ej2_instances&&n.ej2_instances[0]&&(n.ej2_instances[0].value=null,n.ej2_instances[0].dataBind());t=document.getElementById("filtroEstado");t&&t.ej2_instances&&t.ej2_instances[0]&&(t.ej2_instances[0].value=null,t.ej2_instances[0].dataBind());i=document.getElementById("filtroFechaInicio");i&&i.ej2_instances&&i.ej2_instances[0]&&(i.ej2_instances[0].value=null,i.ej2_instances[0].dataBind());r=document.getElementById("filtroFechaFin");r&&r.ej2_instances&&r.ej2_instances[0]&&(r.ej2_instances[0].value=null,r.ej2_instances[0].dataBind());window.Dashboard.Grid.CargarDatos({})}};window.Dashboard.Grid={CargarDatos:function(n){var t={IdCliente:n&&n.idCliente?n.idCliente:null,IdTienda:n&&n.idTienda?n.idTienda:null,Estado:n&&n.estado?n.estado:null,FechaInicio:n&&n.fechaInicio?n.fechaInicio instanceof Date?n.fechaInicio.toISOString():n.fechaInicio:null,FechaFin:n&&n.fechaFin?n.fechaFin instanceof Date?n.fechaFin.toISOString():n.fechaFin:null};$.ajax({url:"/Orders/BuscarOrders",method:"POST",contentType:"application/json",data:JSON.stringify(t),success:function(n){if(n.exito&&n.datos){var t=document.getElementById("dashboardOrdersGrid");t&&t.ej2_instances&&t.ej2_instances[0]&&(t.ej2_instances[0].dataSource=n.datos,t.ej2_instances[0].refresh())}else window.Dashboard.Utilidades.MostrarError("Error",n.mensaje||"No se pudieron cargar las órdenes.")},error:function(n,t,i){window.Dashboard.Utilidades.MostrarError("Error de Conexión","No se pudo conectar al servidor.");console.error("Error al cargar órdenes:",i)}})},Recargar:function(){window.Dashboard.Filtros.Limpiar()}};window.Dashboard.Detalles={Ver:function(n){window.Orders&&window.Orders.Modal?window.Orders.Modal.Abrir(n,"ver"):window.location.href="/Orders"}};window.Dashboard.Utilidades={MostrarError:function(n,t){typeof Swal!="undefined"?Swal.fire({icon:"error",title:n,text:t,confirmButtonText:"Aceptar"}):alert(n+": "+t)},MostrarExito:function(n,t){typeof Swal!="undefined"?Swal.fire({icon:"success",title:n,text:t,confirmButtonText:"Aceptar"}):alert(n+": "+t)}};window.Dashboard.CargarMetricas=function(){window.Dashboard.Metricas.Cargar()};window.filtroClienteIdChange=window.debounce(function(){window.Dashboard.Filtros.Aplicar()},300);window.filtroTiendaIdChange=window.debounce(function(){window.Dashboard.Filtros.Aplicar()},300);window.filtroEstadoChange=window.debounce(function(){window.Dashboard.Filtros.Aplicar()},300);window.filtroFechaInicioChange=window.debounce(function(){window.Dashboard.Filtros.Aplicar()},300);window.filtroFechaFinChange=window.debounce(function(){window.Dashboard.Filtros.Aplicar()},300);window.dashboardOrdersGridCreated=function(){window.Dashboard.Grid.CargarDatos({})};window.dashboardOrdersGridRowSelected=function(){};window.dashboardOrdersGridActionComplete=function(){};window.dashboardOrdersGridToolbarClick=function(n){var t=document.getElementById("dashboardOrdersGrid"),r,i,u;if(!t||!t.ej2_instances||!t.ej2_instances[0]){console.warn("Grid no encontrado para exportación");return}if(r=t.ej2_instances[0],u="Ordenes_Dashboard_"+(new Date).toISOString().split("T")[0],n.item.text==="Excel Export"||n.item.id&&n.item.id.includes("excelexport"))i=r.excelExport({fileName:u+".xlsx"});else if(n.item.text==="Pdf Export"||n.item.id&&n.item.id.includes("pdfexport"))i=r.pdfExport({fileName:u+".pdf"});else return;i&&i.then(function(){window.Dashboard.Utilidades.MostrarExito("Exportación Exitosa","El archivo se ha descargado correctamente.")}).catch(function(n){window.Dashboard.Utilidades.MostrarError("Error de Exportación","No se pudo exportar. Por favor, intenta nuevamente.");console.error("Error al exportar:",n)})}}();